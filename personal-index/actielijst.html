<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actielijst - Project Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --dark-lighter: #1e293b;
            --dark-card: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #475569;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #1e1b4b 100%);
            color: var(--text);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--dark-lighter);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--dark-card);
            border-color: var(--primary);
        }

        .project-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .project-tab {
            padding: 0.875rem 1.5rem;
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 600;
        }

        .project-tab:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .project-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .project-tab .count {
            display: inline-block;
            margin-left: 0.5rem;
            padding: 0.2rem 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            font-size: 0.8rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            padding: 0.875rem 1.25rem;
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 0.95rem;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        select {
            padding: 0.875rem 1.25rem;
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 0.95rem;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-card {
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid var(--border);
        }

        .task-card:hover {
            transform: translateX(4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .task-card.completed {
            opacity: 0.6;
            border-left-color: var(--text-muted) !important;
        }

        .task-card.completed .task-title {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .task-card.status-todo { border-left-color: #3b82f6; }
        .task-card.status-in-progress { border-left-color: #f59e0b; }
        .task-card.status-blocked { border-left-color: #ef4444; }
        .task-card.status-review { border-left-color: #8b5cf6; }
        .task-card.status-done { border-left-color: #10b981; }

        .task-header {
            display: flex;
            align-items: start;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            min-width: 24px;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
        }

        .task-checkbox.checked {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-color: var(--primary);
        }

        .task-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .task-description {
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
        }

        .badge {
            padding: 0.35rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
        }

        .badge-project {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .badge-priority {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .badge-priority.medium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .badge-priority.low {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge-deadline {
            background: rgba(139, 92, 246, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .badge-status {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }

        .badge-status.in-progress {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .badge-status.blocked {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .badge-status.review {
            background: rgba(139, 92, 246, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .badge-status.done {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge-assigned {
            background: rgba(139, 92, 246, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .badge-comment {
            background: rgba(139, 92, 246, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
            cursor: pointer;
        }

        .badge-comment:hover {
            background: rgba(139, 92, 246, 0.3);
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--dark-card);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        .log-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--dark-card);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .log-btn:hover {
            background: var(--secondary);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark-lighter);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--text);
        }

        .close-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--dark-card);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--text);
        }

        .close-btn:hover {
            background: var(--danger);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.875rem;
            background: var(--dark-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 0.95rem;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .date-range {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .date-range .form-group {
            margin-bottom: 0;
        }

        .log-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1001;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .log-modal.active {
            display: flex;
        }

        .log-content {
            background: var(--dark-lighter);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
            overflow-y: auto;
        }

        .log-entry {
            padding: 1rem;
            border-left: 3px solid var(--primary);
            background: var(--dark-card);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .log-entry-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .log-entry-text {
            font-size: 0.9rem;
            color: var(--text);
        }

        .comment {
            background: var(--dark-card);
            border-left: 3px solid var(--primary);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }

        .comment-author {
            font-weight: 600;
            color: var(--secondary);
        }

        .comment-time {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .comment-text {
            color: var(--text);
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .comments-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .comments-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .assigned-section {
            background: var(--dark-card);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 3px solid var(--secondary);
        }

        .assigned-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .assigned-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
        }

        .assigned-edit {
            margin-top: 0.75rem;
        }

        .assigned-edit input {
            width: 100%;
            padding: 0.5rem;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .action-buttons button {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.85rem;
        }

        .close-action-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--dark-card);
            border-radius: 8px;
            border-left: 3px solid var(--warning);
        }

        .close-action-title {
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .back-btn {
            position: fixed;
            top: 2rem;
            left: 2rem;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .back-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: translateX(-4px);
        }

        /* Advanced filters */
        .filter-section {
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .filter-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: var(--dark-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            border-color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Tags */
        .tag-input {
            padding: 0.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            background: var(--dark-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            width: 100%;
        }

        .tag {
            background: var(--secondary);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            font-size: 0.9rem;
        }

        .badge-tag {
            background: rgba(139, 92, 246, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .stat-item-label {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .stat-item-value {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Recurring badge */
        .badge-recurring {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        /* Dependency badge */
        .badge-depends {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        /* Checkbox bulk select */
        .bulk-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .bulk-actions {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .bulk-action-btn {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='index.html'">‚Üê</button>

    <div class="container">
        <header>
            <h1>üìã Actielijst</h1>
            <div class="header-actions" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="openModal('templatesModal')">üìã Sjablonen</button>
                <button class="btn btn-secondary" onclick="openModal('filtersModal')">üîç Filters</button>
                <button class="btn btn-secondary" onclick="openModal('statsModal')">üìä Statistieken</button>
                <button class="btn btn-secondary" onclick="toggleBulkMode()">üì¶ Bulk</button>
                <button class="btn btn-secondary" onclick="openModal('tagsModal')">#Ô∏è‚É£ Tags</button>
                <button class="btn btn-secondary" onclick="openProjectManager()">‚öôÔ∏è Projecten</button>
                <button class="btn btn-secondary" onclick="exportTasks()">üíæ Export</button>
                <button class="btn btn-primary" onclick="openModal('taskModal')">+ Nieuwe Taak</button>
            </div>
        </header>

        <div class="project-tabs" id="projectTabs"></div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="statTotal">0</div>
                <div class="stat-label">Totaal</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statActive">0</div>
                <div class="stat-label">Actief</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statCompleted">0</div>
                <div class="stat-label">Voltooid</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statOverdue">0</div>
                <div class="stat-label">Verlopen</div>
            </div>
        </div>

        <div class="controls">
            <input type="text" class="search-box" placeholder="üîç Zoek taken..." id="searchBox" oninput="filterTasks()">
            <select id="filterPriority" onchange="filterTasks()">
                <option value="">Alle prioriteiten</option>
                <option value="high">Hoog</option>
                <option value="medium">Gemiddeld</option>
                <option value="low">Laag</option>
            </select>
            <select id="filterStatus" onchange="filterTasks()">
                <option value="active">Actief</option>
                <option value="completed">Voltooid</option>
                <option value="all">Alles</option>
            </select>
        </div>

        <div class="task-list" id="taskList"></div>
    </div>

    <!-- Add/Edit Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nieuwe Taak</h2>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            <form id="taskForm" onsubmit="saveTask(event)">
                <div class="form-group">
                    <label>Titel *</label>
                    <input type="text" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label>Beschrijving</label>
                    <textarea id="taskDescription"></textarea>
                </div>
                <div class="date-range">
                    <div class="form-group">
                        <label>Startdatum</label>
                        <input type="date" id="taskStartDate">
                    </div>
                    <div class="form-group">
                        <label>Einddatum</label>
                        <input type="date" id="taskEndDate">
                    </div>
                </div>
                <div class="form-group">
                    <label>Project *</label>
                    <select id="taskProject" required>
                        <option value="">-- Selecteer project --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="taskStatus">
                        <option value="todo">üìã Te doen</option>
                        <option value="in-progress">‚ö° In uitvoering</option>
                        <option value="blocked">üö´ Geblokkeerd</option>
                        <option value="review">üëÄ Review</option>
                        <option value="done">‚úÖ Klaar</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Prioriteit</label>
                    <select id="taskPriority">
                        <option value="low">Laag</option>
                        <option value="medium" selected>Gemiddeld</option>
                        <option value="high">Hoog</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Deadline</label>
                    <input type="date" id="taskDeadline">
                </div>
                <div class="form-group">
                    <label>Overdragen aan</label>
                    <input type="text" id="taskAssignedTo" placeholder="Naam persoon">
                </div>
                <div class="form-group">
                    <label>Opdrachtgeving / Opmerkingen</label>
                    <textarea id="taskComment" placeholder="Voeg hier instructies of opmerkingen toe voor de toegewezen persoon..."></textarea>
                </div>
                <div class="form-group">
                    <label>#Ô∏è‚É£ Tags</label>
                    <div id="taskTagsList" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem;"></div>
                    <small style="color: var(--text-muted);">Klik op tags om toe te voegen/verwijderen</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Annuleren</button>
                    <button type="submit" class="btn btn-primary">Opslaan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Project Manager Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÅ Projecten Beheren</h2>
                <button class="close-btn" onclick="closeProjectModal()">√ó</button>
            </div>
            <div id="projectList" style="margin-bottom: 2rem;"></div>
            <div class="form-group">
                <label>Nieuw project toevoegen</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="newProjectName" placeholder="Projectnaam..." style="flex: 1;">
                    <button class="btn btn-primary" onclick="addProject()" style="width: auto;">Toevoegen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Templates Modal -->
    <div id="templatesModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üìã Taak Sjablonen</h2>
                <span class="close-btn" onclick="closeModal('templatesModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h3 style="margin-bottom: 1rem;">Beschikbare Sjablonen</h3>
                        <div id="templatesList" style="display: flex; flex-direction: column; gap: 0.75rem;"></div>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 1rem;">Nieuwe Sjabloon</h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <div>
                                <label>Sjabloon Naam</label>
                                <input type="text" id="templateName" placeholder="bijv. Wekelijks Report" class="form-input" style="width: 100%; padding: 0.5rem; background: var(--dark-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                            </div>
                            <div>
                                <label>Beschrijving</label>
                                <textarea id="templateDescription" placeholder="Beschrijving van deze taak sjabloon..." class="form-input" rows="3" style="width: 100%; padding: 0.5rem; background: var(--dark-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);"></textarea>
                            </div>
                            <div>
                                <label>Project</label>
                                <select id="templateProject" class="form-input" style="width: 100%; padding: 0.5rem; background: var(--dark-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                                    <option value="">Alle projecten</option>
                                </select>
                            </div>
                            <div>
                                <label>Priority</label>
                                <select id="templatePriority" class="form-input" style="width: 100%; padding: 0.5rem; background: var(--dark-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                                    <option value="low">Laag</option>
                                    <option value="medium" selected>Middel</option>
                                    <option value="high">Hoog</option>
                                </select>
                            </div>
                            <div>
                                <label>Status</label>
                                <select id="templateStatus" class="form-input" style="width: 100%; padding: 0.5rem; background: var(--dark-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                                    <option value="todo" selected>Te Doen</option>
                                    <option value="in-progress">In Uitvoering</option>
                                </select>
                            </div>
                            <button onclick="saveTemplate()" class="btn btn-primary">üíæ Opslaan als Sjabloon</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Filters Modal -->
    <div id="filtersModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üîç Geavanceerde Filters</h2>
                <span class="close-btn" onclick="closeModal('filtersModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="filter-section">
                    <div class="filter-title">Mijn Taken</div>
                    <div class="filter-grid">
                        <button class="filter-btn" onclick="applyFilter('myTasks')">Mijn Taken</button>
                        <button class="filter-btn" onclick="applyFilter('assigned')">Aan Mij Toegewezen</button>
                        <button class="filter-btn" onclick="applyFilter('overdue')">Verlopen</button>
                        <button class="filter-btn" onclick="applyFilter('thisWeek')">Deze Week</button>
                        <button class="filter-btn" onclick="applyFilter('today')">Vandaag</button>
                    </div>
                </div>
                <div class="filter-section">
                    <div class="filter-title">Status Groepen</div>
                    <div class="filter-grid">
                        <button class="filter-btn" onclick="applyFilter('active')">Actief</button>
                        <button class="filter-btn" onclick="applyFilter('pending')">Te Doen</button>
                        <button class="filter-btn" onclick="applyFilter('inReview')">In Review</button>
                        <button class="filter-btn" onclick="applyFilter('done')">Afgerond</button>
                    </div>
                </div>
                <div class="filter-section">
                    <div class="filter-title">Priority</div>
                    <div class="filter-grid">
                        <button class="filter-btn" onclick="applyFilter('highPriority')">üî¥ Hoog</button>
                        <button class="filter-btn" onclick="applyFilter('mediumPriority')">üü° Middel</button>
                        <button class="filter-btn" onclick="applyFilter('lowPriority')">üü¢ Laag</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="statsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üìä Statistieken Dashboard</h2>
                <span class="close-btn" onclick="closeModal('statsModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-item-label">Totale Taken</div>
                        <div class="stat-item-value" id="statTotalTasks">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">Afgerond %</div>
                        <div class="stat-item-value" id="statCompletionRate">0%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">Verlopen Taken</div>
                        <div class="stat-item-value" id="statOverdue">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">Deze Week</div>
                        <div class="stat-item-value" id="statThisWeek">0</div>
                    </div>
                </div>
                <div style="margin-top: 2rem;">
                    <h3 style="margin-bottom: 1rem;">Taken per Persoon</h3>
                    <div id="statsPerPerson" style="display: grid; gap: 0.75rem;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tags Modal -->
    <div id="tagsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>#Ô∏è‚É£ Tags Manager</h2>
                <span class="close-btn" onclick="closeModal('tagsModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div>
                    <label>Beschikbare Tags</label>
                    <div id="availableTagsList" style="display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 1.5rem;"></div>
                </div>
                <div>
                    <label>Nieuwe Tag</label>
                    <input type="text" id="newTagInput" placeholder="#tag-naam" class="form-input" style="width: 100%; padding: 0.5rem; background: var(--dark-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); margin-bottom: 0.5rem;">
                    <button onclick="addNewTag()" class="btn btn-primary">Voeg Tag Toe</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Log Modal -->
    <div class="log-modal" id="logModal">
        <div class="log-content">
            <div class="modal-header">
                <h2>Activiteiten Log</h2>
                <button class="close-btn" onclick="closeLogModal()">√ó</button>
            </div>
            
            <div class="assigned-section" id="assignedSection"></div>
            
            <div id="logList"></div>
            
            <div class="close-action-section" id="closeActionSection" style="display: none;">
                <div class="close-action-title">‚úÖ Actie Afmelden</div>
                <div class="form-group">
                    <label>Opdrachtgeving bij afmelding</label>
                    <textarea id="closeComment" placeholder="Beschrijf wat je hebt afgehandeld..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Eindstatus *</label>
                        <select id="closeStatus">
                            <option value="">-- Selecteer status --</option>
                            <option value="done">‚úÖ Afgehandeld</option>
                            <option value="blocked">üö´ Geblokkeerd</option>
                            <option value="review">üëÄ Needs Review</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nieuwe actiehouder (optioneel)</label>
                        <input type="text" id="newAssignee" placeholder="Laat leeg als taak klaar is">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeLogModal()">Annuleren</button>
                    <button class="btn btn-primary" onclick="submitCloseAction()">Actie Afmelden</button>
                </div>
            </div>
            
            <div class="comments-section" id="commentsSection" style="display: none;">
                <div class="comments-title">üí¨ Opmerkingen</div>
                <div id="commentsList"></div>
                <div class="form-group" style="margin-top: 1rem;">
                    <textarea id="newComment" placeholder="Voeg een opmerking toe..."></textarea>
                </div>
                <button class="btn btn-primary" onclick="addComment()" style="width: 100%;">Opmerking Toevoegen</button>
            </div>
        </div>
    </div>

    <script>
        let tasks = [];
        let currentTaskTags = [];
        let editingTaskId = null;
        let selectedProject = 'all';
        let currentLogTaskId = null;
        let projects = ['OneCRM', 'Tranch 4', 'PriceKeys'];

        // Load tasks from localStorage
        function loadTasks() {
            const stored = localStorage.getItem('tasks');
            tasks = stored ? JSON.parse(stored) : [];
            const storedProjects = localStorage.getItem('projects');
            if (storedProjects) {
                projects = JSON.parse(storedProjects);
            }
            updateProjectSelect();
            renderProjectTabs();
            updateStats();
            renderTasks();
        }

        // Update project select options
        function updateProjectSelect() {
            const select = document.getElementById('taskProject');
            if (select) {
                const currentValue = select.value;
                select.innerHTML = '<option value="">-- Selecteer project --</option>' +
                    projects.map(p => `<option value="${p}">${p}</option>`).join('');
                select.value = currentValue;
            }
            
            // Update template project select too
            const templateSelect = document.getElementById('templateProject');
            if (templateSelect) {
                const currentValue = templateSelect.value;
                templateSelect.innerHTML = '<option value="">Alle projecten</option>' +
                    projects.map(p => `<option value="${p}">${p}</option>`).join('');
                templateSelect.value = currentValue;
            }
        }

        // Save tasks to localStorage
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('projects', JSON.stringify(projects));
            updateStats();
        }

        // Render project tabs
        function renderProjectTabs() {
            const projectTabs = document.getElementById('projectTabs');
            
            const projectCounts = {};
            projects.forEach(p => {
                projectCounts[p] = tasks.filter(t => t.project === p && !t.completed).length;
            });
            projectCounts['all'] = tasks.filter(t => !t.completed).length;

            projectTabs.innerHTML = `
                <div class="project-tab ${selectedProject === 'all' ? 'active' : ''}" onclick="selectProject('all')">
                    üåê Alle Projecten <span class="count">${projectCounts['all']}</span>
                </div>
                ${projects.map(project => `
                    <div class="project-tab ${selectedProject === project ? 'active' : ''}" onclick="selectProject('${project}')">
                        ${project} <span class="count">${projectCounts[project]}</span>
                    </div>
                `).join('')}
            `;
        }

        // Select project
        function selectProject(project) {
            selectedProject = project;
            renderProjectTabs();
            renderTasks();
            updateStats();
        }

        // Render tasks
        function renderTasks() {
            const taskList = document.getElementById('taskList');
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const filterPriority = document.getElementById('filterPriority').value;
            const filterStatus = document.getElementById('filterStatus').value;

            let filteredTasks = tasks.filter(task => {
                const matchesSearch = task.title.toLowerCase().includes(searchTerm) || 
                                    (task.description && task.description.toLowerCase().includes(searchTerm));
                const matchesProject = selectedProject === 'all' || task.project === selectedProject;
                const matchesPriority = !filterPriority || task.priority === filterPriority;
                const matchesStatus = filterStatus === 'all' || 
                                     (filterStatus === 'completed' ? task.completed : !task.completed);
                return matchesSearch && matchesProject && matchesPriority && matchesStatus;
            });

            filteredTasks.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                if (a.deadline && b.deadline) return new Date(a.deadline) - new Date(b.deadline);
                return 0;
            });

            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <h3>Geen taken gevonden</h3>
                        <p>Voeg een nieuwe taak toe om te beginnen!</p>
                    </div>
                `;
                return;
            }

            taskList.innerHTML = filteredTasks.map(task => {
                const isOverdue = task.deadline && new Date(task.deadline) < new Date() && !task.completed;
                const priorityLabels = { high: 'Hoog', medium: 'Gemiddeld', low: 'Laag' };
                const statusLabels = { 
                    todo: 'üìã Te doen', 
                    'in-progress': '‚ö° In uitvoering', 
                    blocked: 'üö´ Geblokkeerd', 
                    review: 'üëÄ Review', 
                    done: '‚úÖ Klaar' 
                };
                const taskStatus = task.status || 'todo';
                
                return `
                    <div class="task-card status-${taskStatus} ${task.completed ? 'completed' : ''}">
                        <div class="task-header">
                            <div class="task-checkbox ${task.completed ? 'checked' : ''}" 
                                 onclick="toggleTask('${task.id}')"></div>
                            <div class="task-content">
                                <div class="task-title">${task.title}</div>
                                ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                                <div class="task-meta">
                                    ${task.project ? `<span class="badge badge-project">üìÅ ${task.project}</span>` : ''}
                                    <span class="badge badge-status ${taskStatus}">${statusLabels[taskStatus]}</span>
                                    <span class="badge badge-priority ${task.priority}">
                                        ${task.priority === 'high' ? 'üî•' : task.priority === 'medium' ? '‚ö°' : '‚úì'} 
                                        ${priorityLabels[task.priority]}
                                    </span>
                                    ${task.deadline ? `
                                        <span class="badge badge-deadline ${isOverdue ? 'badge-priority' : ''}">
                                            üìÖ ${new Date(task.deadline).toLocaleDateString('nl-NL')}
                                            ${isOverdue ? ' (Verlopen!)' : ''}
                                        </span>
                                    ` : ''}
                                    ${task.assignedTo ? `<span class="badge badge-assigned">üë§ ${task.assignedTo}</span>` : ''}
                                    ${task.tags && task.tags.length > 0 ? task.tags.map(tagName => {
                                        const tagObj = tags.find(t => t.name === tagName);
                                        return tagObj ? `<span class="badge" onclick="applyTagFilter('${tagName}')" style="background: ${tagObj.color}30; border: 1px solid ${tagObj.color}; color: ${tagObj.color}; cursor: pointer; transition: all 0.2s ease;" onmouseover="this.style.background='${tagObj.color}50'" onmouseout="this.style.background='${tagObj.color}30'">${tagName}</span>` : '';
                                    }).join('') : ''}
                                </div>
                            </div>
                            <div class="task-actions">
                                <button class="log-btn" onclick="showTaskLog('${task.id}')" title="Activiteiten">üìã</button>
                                ${task.comments && task.comments.length > 0 ? `<span class="badge badge-comment" onclick="showTaskLog('${task.id}')">üí¨ ${task.comments.length}</span>` : ''}
                                <button class="icon-btn" onclick="editTask('${task.id}')" title="Bewerken">‚úèÔ∏è</button>
                                <button class="icon-btn" onclick="deleteTask('${task.id}')" title="Verwijderen">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update stats
        function updateStats() {
            const projectTasks = selectedProject === 'all' 
                ? tasks 
                : tasks.filter(t => t.project === selectedProject);
            
            const total = projectTasks.length;
            const active = projectTasks.filter(t => !t.completed).length;
            const completed = projectTasks.filter(t => t.completed).length;
            const overdue = projectTasks.filter(t => !t.completed && t.deadline && new Date(t.deadline) < new Date()).length;

            document.getElementById('statTotal').textContent = total;
            document.getElementById('statActive').textContent = active;
            document.getElementById('statCompleted').textContent = completed;
            document.getElementById('statOverdue').textContent = overdue;
        }

        // Open modal
        function openModal(taskIdOrModal = null) {
            // Als het een bestaande modal-ID is (bevat 'Modal'), open die
            if (typeof taskIdOrModal === 'string' && taskIdOrModal.includes('Modal')) {
                const modal = document.getElementById(taskIdOrModal);
                if (modal) modal.classList.add('active');
                return;
            }

            // Anders behandel als task ID
            const taskId = taskIdOrModal;
            editingTaskId = taskId;
            const modal = document.getElementById('taskModal');
            const form = document.getElementById('taskForm');
            
            if (taskId) {
                const task = tasks.find(t => t.id === taskId);
                document.getElementById('modalTitle').textContent = 'Taak Bewerken';
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description || '';
                document.getElementById('taskProject').value = task.project || '';
                document.getElementById('taskStatus').value = task.status || 'todo';
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskDeadline').value = task.deadline || '';
                document.getElementById('taskStartDate').value = task.startDate || '';
                document.getElementById('taskEndDate').value = task.endDate || '';
                document.getElementById('taskAssignedTo').value = task.assignedTo || '';
                document.getElementById('taskComment').value = task.comment || '';
                
                // Load tags
                currentTaskTags = task.tags || [];
                renderTaskTagsSelector();
            } else {
                document.getElementById('modalTitle').textContent = 'Nieuwe Taak';
                form.reset();
                currentTaskTags = [];
                renderTaskTagsSelector();
                if (selectedProject !== 'all') {
                    document.getElementById('taskProject').value = selectedProject;
                }
            }
            
            modal.classList.add('active');
        }

        // Close modal
        function closeModal(modalId = 'taskModal') {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
            editingTaskId = null;
            currentTaskTags = [];
        }

        // Render tags selector in task form
        function renderTaskTagsSelector() {
            const container = document.getElementById('taskTagsList');
            if (!tags || tags.length === 0) {
                container.innerHTML = '<small style="color: var(--text-muted);">Geen tags beschikbaar. Maak eerst tags aan in de Tags Manager.</small>';
                return;
            }

            container.innerHTML = tags.map(tag => {
                const isSelected = currentTaskTags.includes(tag.name);
                return `
                    <div 
                        onclick="toggleTaskTag('${tag.name}')" 
                        style="
                            cursor: pointer;
                            padding: 0.35rem 0.75rem;
                            border-radius: 6px;
                            background: ${isSelected ? tag.color : 'rgba(' + parseInt(tag.color.slice(1,3), 16) + ',' + parseInt(tag.color.slice(3,5), 16) + ',' + parseInt(tag.color.slice(5,7), 16) + ', 0.1)'};
                            border: 2px solid ${tag.color};
                            color: ${isSelected ? 'white' : tag.color};
                            font-size: 0.85rem;
                            font-weight: ${isSelected ? '600' : '500'};
                            transition: all 0.2s ease;
                        ">
                        ${isSelected ? '‚úì ' : ''}${tag.name}
                    </div>
                `;
            }).join('');
        }

        // Toggle tag for current task
        function toggleTaskTag(tagName) {
            if (currentTaskTags.includes(tagName)) {
                currentTaskTags = currentTaskTags.filter(t => t !== tagName);
            } else {
                currentTaskTags.push(tagName);
            }
            renderTaskTagsSelector();
        }

        // Save task
        function saveTask(event) {
            event.preventDefault();
            
            const task = {
                id: editingTaskId || Date.now().toString(),
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                project: document.getElementById('taskProject').value,
                status: document.getElementById('taskStatus').value,
                priority: document.getElementById('taskPriority').value,
                deadline: document.getElementById('taskDeadline').value,
                startDate: document.getElementById('taskStartDate').value,
                endDate: document.getElementById('taskEndDate').value,
                assignedTo: document.getElementById('taskAssignedTo').value,
                comment: document.getElementById('taskComment').value,
                tags: currentTaskTags,
                completed: false,
                createdAt: new Date().toISOString(),
                log: [],
                comments: []
            };

            if (editingTaskId) {
                const index = tasks.findIndex(t => t.id === editingTaskId);
                const oldTask = tasks[index];
                task.log = oldTask.log || [];
                task.comments = oldTask.comments || [];
                task.createdAt = oldTask.createdAt;
                task.completed = oldTask.completed;
                
                if (oldTask.assignedTo !== task.assignedTo) {
                    addTaskLog(task.id, `Overdragen aan ${task.assignedTo || 'niemand'}`);
                    if (task.assignedTo && task.comment) {
                        addCommentToTask(task.id, task.comment);
                    }
                }
                if (oldTask.status !== task.status) {
                    const statuses = { todo: 'Te doen', 'in-progress': 'In uitvoering', blocked: 'Geblokkeerd', review: 'Review', done: 'Klaar' };
                    addTaskLog(task.id, `Status gewijzigd naar ${statuses[task.status]}`);
                }
                
                tasks[index] = { ...oldTask, ...task, log: task.log, comments: task.comments };
            } else {
                task.log = [];
                task.comments = [];
                addTaskLog(task.id, `Taak aangemaakt`);
                if (task.assignedTo && task.comment) {
                    addCommentToTask(task.id, task.comment);
                }
                tasks.push(task);
            }

            saveTasks();
            renderProjectTabs();
            renderTasks();
            closeModal();
        }

        // Toggle task completion
        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            task.completed = !task.completed;
            task.completedDate = task.completed ? new Date().toISOString().split('T')[0] : null;
            addTaskLog(id, task.completed ? '‚úÖ Voltooid' : 'üîÑ Heropend');
            saveTasks();
            renderProjectTabs();
            renderTasks();
        }

        // Edit task
        function editTask(id) {
            openModal(id);
        }

        // Delete task
        function deleteTask(id) {
            if (confirm('Weet je zeker dat je deze taak wilt verwijderen?')) {
                tasks = tasks.filter(t => t.id !== id);
                saveTasks();
                renderProjectTabs();
                renderTasks();
            }
        }

        // Filter tasks
        function filterTasks() {
            renderTasks();
        }

        // Export tasks to CSV
        function exportTasks() {
            const statusLabels = { 
                todo: 'Te doen', 
                'in-progress': 'In uitvoering', 
                blocked: 'Geblokkeerd', 
                review: 'Review', 
                done: 'Klaar' 
            };
            
            const csv = [
                ['Titel', 'Beschrijving', 'Project', 'Status', 'Prioriteit', 'Deadline', 'Voltooid', 'Aangemaakt'].join(','),
                ...tasks.map(t => [
                    `"${t.title}"`,
                    `"${t.description || ''}"`,
                    `"${t.project || ''}"`,
                    statusLabels[t.status || 'todo'],
                    t.priority,
                    t.deadline || '',
                    t.completed ? 'Ja' : 'Nee',
                    new Date(t.createdAt).toLocaleDateString('nl-NL')
                ].join(','))
            ].join('\n');

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `actielijst-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Add log entry to task
        function addTaskLog(taskId, message) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                if (!task.log) task.log = [];
                task.log.push({
                    timestamp: new Date().toISOString(),
                    message: message
                });
            }
        }

        // Add comment to task
        function addCommentToTask(taskId, text, author = null) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                if (!task.comments) task.comments = [];
                const commentAuthor = author || task.assignedTo || 'Ik';
                task.comments.push({
                    timestamp: new Date().toISOString(),
                    author: commentAuthor,
                    text: text
                });
                saveTasks();
            }
        }

        // Add comment from modal
        function addComment() {
            const commentText = document.getElementById('newComment').value;
            if (!commentText.trim()) {
                alert('Voer een opmerking in');
                return;
            }
            
            addCommentToTask(currentLogTaskId, commentText);
            document.getElementById('newComment').value = '';
            showTaskLog(currentLogTaskId);
        }

        // Show task activity log
        function showTaskLog(taskId) {
            currentLogTaskId = taskId;
            const task = tasks.find(t => t.id === taskId);
            const logList = document.getElementById('logList');
            const commentsSection = document.getElementById('commentsSection');
            const commentsList = document.getElementById('commentsList');
            const assignedSection = document.getElementById('assignedSection');
            const closeActionSection = document.getElementById('closeActionSection');
            
            if (task.assignedTo) {
                assignedSection.innerHTML = `
                    <div class="assigned-label">Huidige Actiehouder:</div>
                    <div class="assigned-value">${task.assignedTo}</div>
                    <div class="assigned-edit">
                        <input type="text" id="editAssignee" value="${task.assignedTo}" placeholder="Wijzig actiehouder">
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="cancelEditAssignee()">Annuleren</button>
                            <button class="btn btn-primary" onclick="saveAssignee()">Opslaan</button>
                        </div>
                    </div>
                `;
            } else {
                assignedSection.innerHTML = '<div class="assigned-label">Geen actiehouder toegewezen</div>';
            }
            
            if (!task.completed && task.assignedTo) {
                closeActionSection.style.display = 'block';
            } else {
                closeActionSection.style.display = 'none';
            }
            
            if (!task.log || task.log.length === 0) {
                logList.innerHTML = '<div class="empty-state"><p>Geen activiteiten geregistreerd</p></div>';
            } else {
                logList.innerHTML = task.log.map(entry => {
                    const date = new Date(entry.timestamp);
                    const timeStr = date.toLocaleString('nl-NL');
                    return `
                        <div class="log-entry">
                            <div class="log-entry-time">${timeStr}</div>
                            <div class="log-entry-text">${entry.message}</div>
                        </div>
                    `;
                }).join('');
            }
            
            if (task.comments && task.comments.length > 0) {
                commentsList.innerHTML = task.comments.map(comment => {
                    const date = new Date(comment.timestamp);
                    const timeStr = date.toLocaleString('nl-NL');
                    return `
                        <div class="comment">
                            <div class="comment-header">
                                <span class="comment-author">${comment.author}</span>
                                <span class="comment-time">${timeStr}</span>
                            </div>
                            <div class="comment-text">${comment.text}</div>
                        </div>
                    `;
                }).join('');
                commentsSection.style.display = 'block';
            } else {
                commentsSection.style.display = 'block';
                commentsList.innerHTML = '<p style="color: var(--text-muted);">Geen opmerkingen nog</p>';
            }
            
            document.getElementById('logModal').classList.add('active');
        }

        // Close log modal
        function closeLogModal() {
            document.getElementById('logModal').classList.remove('active');
            currentLogTaskId = null;
        }

        // Save edited assignee
        function saveAssignee() {
            const task = tasks.find(t => t.id === currentLogTaskId);
            const newAssignee = document.getElementById('editAssignee').value.trim();
            
            if (!newAssignee) {
                alert('Voer een actiehouder in');
                return;
            }
            
            if (task.assignedTo !== newAssignee) {
                task.assignedTo = newAssignee;
                addTaskLog(task.id, `Actiehouder gewijzigd naar ${newAssignee}`);
                saveTasks();
                showTaskLog(currentLogTaskId);
            }
        }

        // Cancel edit assignee
        function cancelEditAssignee() {
            showTaskLog(currentLogTaskId);
        }

        // Submit close action
        function submitCloseAction() {
            const task = tasks.find(t => t.id === currentLogTaskId);
            const status = document.getElementById('closeStatus').value;
            const comment = document.getElementById('closeComment').value.trim();
            const newAssignee = document.getElementById('newAssignee').value.trim();
            
            if (!status) {
                alert('Selecteer een eindstatus');
                return;
            }
            
            if (!comment) {
                alert('Beschrijf wat je hebt afgehandeld');
                return;
            }
            
            addCommentToTask(task.id, `[AFGEMELD] ${comment}`);
            
            const statuses = { done: 'Afgehandeld', blocked: 'Geblokkeerd', review: 'Needs Review' };
            addTaskLog(task.id, `Actie afgemeld - Status: ${statuses[status]}`);
            
            if (newAssignee) {
                task.assignedTo = newAssignee;
                addTaskLog(task.id, `Nieuwe actie toegewezen aan ${newAssignee}`);
            } else {
                task.status = status;
                if (status === 'done') {
                    task.completed = true;
                    addTaskLog(task.id, '‚úÖ Taak voltooid');
                }
                task.assignedTo = '';
            }
            
            saveTasks();
            renderProjectTabs();
            renderTasks();
            closeLogModal();
        }

        // Project manager functions
        function openProjectManager() {
            const projectList = document.getElementById('projectList');
            projectList.innerHTML = `
                <div class="comments-title">Huidige projecten:</div>
                ${projects.map((p, idx) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--dark-card); border-radius: 8px; margin-bottom: 0.5rem;">
                        <span>üìÅ ${p}</span>
                        <button class="icon-btn" onclick="deleteProject(${idx})" style="background: var(--danger);">üóëÔ∏è</button>
                    </div>
                `).join('')}
            `;
            document.getElementById('projectModal').classList.add('active');
            document.getElementById('newProjectName').value = '';
        }

        // Close log modal
        function closeLogModal() {
            closeModal('logModal');
        }

        // Close project modal
        function closeProjectModal() {
            closeModal('projectModal');
        }

        function addProject() {
            const name = document.getElementById('newProjectName').value.trim();
            if (!name) {
                alert('Voer een projectnaam in');
                return;
            }
            
            if (projects.includes(name)) {
                alert('Dit project bestaat al');
                return;
            }
            
            projects.push(name);
            saveTasks();
            updateProjectSelect();
            renderProjectTabs();
            openProjectManager();
        }

        function deleteProject(idx) {
            if (confirm(`Weet je zeker dat je het project "${projects[idx]}" wilt verwijderen?`)) {
                projects.splice(idx, 1);
                saveTasks();
                updateProjectSelect();
                renderProjectTabs();
                if (selectedProject === projects[idx]) {
                    selectProject('all');
                }
                openProjectManager();
            }
        }

        // Initialize
        let templates = [];
        let bulkSelected = new Set();
        let bulkMode = false;
        let tags = [];
        let allTasks = [];

        // FEATURE 1: Templates/Sjablonen
        function saveTemplate() {
            const name = document.getElementById('templateName').value.trim();
            const description = document.getElementById('templateDescription').value.trim();
            const project = document.getElementById('templateProject').value;
            const priority = document.getElementById('templatePriority').value;
            const status = document.getElementById('templateStatus').value;

            if (!name) {
                alert('Voer een sjabloon naam in');
                return;
            }

            const template = {
                id: Date.now().toString(),
                name,
                description,
                project,
                priority,
                status
            };

            templates.push(template);
            localStorage.setItem('templates', JSON.stringify(templates));
            document.getElementById('templateName').value = '';
            document.getElementById('templateDescription').value = '';
            renderTemplatesList();
        }

        function renderTemplatesList() {
            const list = document.getElementById('templatesList');
            if (templates.length === 0) {
                list.innerHTML = '<p style="color: var(--text-muted);">Geen sjablonen beschikbaar</p>';
                return;
            }
            list.innerHTML = templates.map(t => `
                <div style="background: var(--dark-card); padding: 0.75rem; border-radius: 8px; border-left: 3px solid var(--primary);">
                    <div style="font-weight: 600;">${t.name}</div>
                    ${t.description ? `<div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem;">${t.description}</div>` : ''}
                    <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
                        <button onclick="createFromTemplate('${t.id}')" class="btn btn-primary" style="font-size: 0.8rem;">Gebruiken</button>
                        <button onclick="deleteTemplate('${t.id}')" class="btn btn-danger" style="font-size: 0.8rem;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function createFromTemplate(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;

            document.getElementById('modalTitle').textContent = 'Nieuwe Taak van Sjabloon';
            document.getElementById('taskTitle').value = template.name;
            document.getElementById('taskDescription').value = template.description || '';
            document.getElementById('taskProject').value = template.project || '';
            document.getElementById('taskStatus').value = template.status || 'todo';
            document.getElementById('taskPriority').value = template.priority;
            
            document.getElementById('taskModal').classList.add('active');
            closeModal('templatesModal');
        }

        function deleteTemplate(templateId) {
            if (confirm('Weet je zeker dat je deze sjabloon wilt verwijderen?')) {
                templates = templates.filter(t => t.id !== templateId);
                localStorage.setItem('templates', JSON.stringify(templates));
                renderTemplatesList();
            }
        }

        // FEATURE 2: Recurring Tasks
        function setupRecurringTask(taskId) {
            document.getElementById('recurringModal').dataset.taskId = taskId;
            document.getElementById('recurringType').value = 'none';
            document.getElementById('recurringOptions').style.display = 'none';
            openModal('recurringModal');
        }

        function updateRecurringUI() {
            const type = document.getElementById('recurringType').value;
            document.getElementById('recurringOptions').style.display = type !== 'none' ? 'block' : 'none';
        }

        function saveRecurringSettings() {
            const taskId = document.getElementById('recurringModal').dataset.taskId;
            const type = document.getElementById('recurringType').value;
            const interval = parseInt(document.getElementById('recurringInterval').value) || 1;
            const endDate = document.getElementById('recurringEndDate').value;

            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            task.recurring = { type, interval, endDate, lastCreated: new Date().toISOString() };
            saveTasks();
            closeModal('recurringModal');

            // Create next instance if needed
            if (type !== 'none') {
                setTimeout(() => createNextRecurringTask(taskId), 100);
            }
        }

        function createNextRecurringTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || !task.recurring || task.recurring.type === 'none') return;

            const nextDate = getNextRecurringDate(task.recurring);
            if (task.recurring.endDate && nextDate > new Date(task.recurring.endDate)) return;

            const newTask = { ...task, id: Date.now().toString(), completed: false };
            delete newTask.log;
            delete newTask.comments;
            tasks.push(newTask);
            saveTasks();
        }

        function getNextRecurringDate(recurring) {
            const last = new Date(recurring.lastCreated);
            const next = new Date(last);
            
            switch(recurring.type) {
                case 'daily':
                    next.setDate(next.getDate() + recurring.interval);
                    break;
                case 'weekly':
                    next.setDate(next.getDate() + (7 * recurring.interval));
                    break;
                case 'monthly':
                    next.setMonth(next.getMonth() + recurring.interval);
                    break;
            }
            return next;
        }

        // FEATURE 3: Task Dependencies
        function addTaskDependency(taskId, dependsOnTaskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            if (!task.dependencies) task.dependencies = [];
            if (!task.dependencies.includes(dependsOnTaskId)) {
                task.dependencies.push(dependsOnTaskId);
                saveTasks();
            }
        }

        function removeTaskDependency(taskId, dependsOnTaskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && task.dependencies) {
                task.dependencies = task.dependencies.filter(d => d !== dependsOnTaskId);
                saveTasks();
            }
        }

        function canTaskBeStarted(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || !task.dependencies || task.dependencies.length === 0) return true;
            
            return task.dependencies.every(depId => {
                const depTask = tasks.find(t => t.id === depId);
                return depTask && depTask.completed;
            });
        }

        // FEATURE 4: Advanced Filters
        function applyFilter(filterType) {
            let filtered = [];

            switch(filterType) {
                case 'myTasks':
                    filtered = tasks.filter(t => !t.completed && !t.assignedTo);
                    break;
                case 'assigned':
                    filtered = tasks.filter(t => t.assignedTo && !t.completed);
                    break;
                case 'overdue':
                    filtered = tasks.filter(t => !t.completed && t.deadline && new Date(t.deadline) < new Date());
                    break;
                case 'thisWeek':
                    const today = new Date();
                    const weekEnd = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                    filtered = tasks.filter(t => {
                        if (!t.deadline) return false;
                        const d = new Date(t.deadline);
                        return d >= today && d <= weekEnd && !t.completed;
                    });
                    break;
                case 'today':
                    const todayStr = new Date().toISOString().split('T')[0];
                    filtered = tasks.filter(t => t.deadline && t.deadline.startsWith(todayStr) && !t.completed);
                    break;
                case 'active':
                    filtered = tasks.filter(t => (t.status === 'in-progress' || t.status === 'blocked') && !t.completed);
                    break;
                case 'pending':
                    filtered = tasks.filter(t => t.status === 'todo' && !t.completed);
                    break;
                case 'inReview':
                    filtered = tasks.filter(t => t.status === 'review' && !t.completed);
                    break;
                case 'done':
                    filtered = tasks.filter(t => t.status === 'done' || t.completed);
                    break;
                case 'highPriority':
                    filtered = tasks.filter(t => t.priority === 'high' && !t.completed);
                    break;
                case 'mediumPriority':
                    filtered = tasks.filter(t => t.priority === 'medium' && !t.completed);
                    break;
                case 'lowPriority':
                    filtered = tasks.filter(t => t.priority === 'low' && !t.completed);
                    break;
            }

            // Apply filter
            const taskList = document.getElementById('taskList');
            if (filtered.length === 0) {
                taskList.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üì≠</div><h3>Geen taken gevonden</h3></div>`;
                return;
            }

            taskList.innerHTML = filtered.map(task => {
                const isOverdue = task.deadline && new Date(task.deadline) < new Date() && !task.completed;
                const priorityLabels = { high: 'Hoog', medium: 'Gemiddeld', low: 'Laag' };
                const statusLabels = { 
                    todo: 'üìã Te doen', 
                    'in-progress': '‚ö° In uitvoering', 
                    blocked: 'üö´ Geblokkeerd', 
                    review: 'üëÄ Review', 
                    done: '‚úÖ Klaar' 
                };
                const taskStatus = task.status || 'todo';
                
                return `
                    <div class="task-card status-${taskStatus} ${task.completed ? 'completed' : ''}">
                        <div class="task-header">
                            <div class="task-checkbox ${task.completed ? 'checked' : ''}" 
                                 onclick="toggleTask('${task.id}')"></div>
                            <div class="task-content">
                                <div class="task-title">${task.title}</div>
                                ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                                <div class="task-meta">
                                    ${task.project ? `<span class="badge badge-project">üìÅ ${task.project}</span>` : ''}
                                    <span class="badge badge-status ${taskStatus}">${statusLabels[taskStatus]}</span>
                                    <span class="badge badge-priority ${task.priority}">
                                        ${task.priority === 'high' ? 'üî•' : task.priority === 'medium' ? '‚ö°' : '‚úì'} 
                                        ${priorityLabels[task.priority]}
                                    </span>
                                    ${task.deadline ? `
                                        <span class="badge badge-deadline ${isOverdue ? 'badge-priority' : ''}">
                                            üìÖ ${new Date(task.deadline).toLocaleDateString('nl-NL')}
                                            ${isOverdue ? ' (Verlopen!)' : ''}
                                        </span>
                                    ` : ''}
                                    ${task.assignedTo ? `<span class="badge badge-assigned">üë§ ${task.assignedTo}</span>` : ''}
                                </div>
                            </div>
                            <div class="task-actions">
                                <button class="log-btn" onclick="showTaskLog('${task.id}')" title="Activiteiten">üìã</button>
                                <button class="icon-btn" onclick="editTask('${task.id}')" title="Bewerken">‚úèÔ∏è</button>
                                <button class="icon-btn" onclick="deleteTask('${task.id}')" title="Verwijderen">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            closeModal('filtersModal');
        }

        // FEATURE 5: Statistics Dashboard
        function updateStatistics() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;
            const completionRate = totalTasks === 0 ? 0 : Math.round((completedTasks / totalTasks) * 100);
            const overdueTasks = tasks.filter(t => !t.completed && t.deadline && new Date(t.deadline) < new Date()).length;
            
            const today = new Date();
            const weekEnd = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            const thisWeekTasks = tasks.filter(t => {
                if (!t.deadline) return false;
                const d = new Date(t.deadline);
                return d >= today && d <= weekEnd && !t.completed;
            }).length;

            document.getElementById('statTotalTasks').textContent = totalTasks;
            document.getElementById('statCompletionRate').textContent = completionRate + '%';
            document.getElementById('statOverdue').textContent = overdueTasks;
            document.getElementById('statThisWeek').textContent = thisWeekTasks;

            // Per person stats
            const tasksByPerson = {};
            tasks.forEach(t => {
                const person = t.assignedTo || 'Niemand';
                if (!tasksByPerson[person]) tasksByPerson[person] = { total: 0, completed: 0 };
                tasksByPerson[person].total++;
                if (t.completed) tasksByPerson[person].completed++;
            });

            const personList = document.getElementById('statsPerPerson');
            personList.innerHTML = Object.entries(tasksByPerson).map(([person, stats]) => `
                <div style="background: var(--dark-card); padding: 1rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600;">${person}</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">${stats.completed}/${stats.total} voltooid</div>
                    </div>
                    <div style="font-size: 1.5rem; font-weight: 800; color: var(--primary);">${Math.round((stats.completed/stats.total)*100)}%</div>
                </div>
            `).join('');
        }

        // FEATURE 6: Bulk Actions
        function toggleBulkMode() {
            bulkMode = !bulkMode;
            bulkSelected.clear();
            if (!bulkMode) {
                document.querySelectorAll('.bulk-checkbox').forEach(cb => cb.style.display = 'none');
                document.querySelector('.bulk-actions').style.display = 'none';
            } else {
                document.querySelectorAll('.bulk-checkbox').forEach(cb => cb.style.display = 'block');
                document.querySelector('.bulk-actions').style.display = 'flex';
            }
        }

        function toggleBulkSelect(taskId) {
            if (bulkSelected.has(taskId)) {
                bulkSelected.delete(taskId);
            } else {
                bulkSelected.add(taskId);
            }
        }

        function executeBulkUpdate() {
            const newStatus = document.getElementById('bulkStatus').value;
            const newPriority = document.getElementById('bulkPriority').value;

            bulkSelected.forEach(taskId => {
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    if (newStatus) task.status = newStatus;
                    if (newPriority) task.priority = newPriority;
                    if (!task.log) task.log = [];
                    task.log.push({
                        timestamp: new Date().toISOString(),
                        message: `Bulk update: Status ${newStatus || 'ongewijzigd'}, Priority ${newPriority || 'ongewijzigd'}`
                    });
                }
            });

            saveTasks();
            renderTasks();
            bulkSelected.clear();
            toggleBulkMode();
            alert(`${bulkSelected.size} taken bijgewerkt`);
        }

        function executeBulkDelete() {
            if (!confirm(`Weet je zeker dat je ${bulkSelected.size} taken wilt verwijderen?`)) return;

            bulkSelected.forEach(taskId => {
                tasks = tasks.filter(t => t.id !== taskId);
            });

            saveTasks();
            renderTasks();
            bulkSelected.clear();
            toggleBulkMode();
        }

        // FEATURE 7: Browser Notifications
        function checkDeadlines() {
            if (!('Notification' in window)) return;
            if (Notification.permission !== 'granted') {
                Notification.requestPermission();
            }

            const today = new Date();
            const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);

            tasks.filter(t => !t.completed && t.deadline).forEach(task => {
                const deadline = new Date(task.deadline);
                if (deadline >= today && deadline <= tomorrow) {
                    new Notification('Taak Deadline Nabij', {
                        body: `${task.title} moet morgen voltooid zijn!`,
                        icon: 'üìã'
                    });
                }
            });
        }

        // Check deadlines every hour
        setInterval(checkDeadlines, 60 * 60 * 1000);

        // FEATURE 8: Tags System
        function addNewTag() {
            const input = document.getElementById('newTagInput');
            let tagName = input.value.trim();
            if (!tagName.startsWith('#')) tagName = '#' + tagName;

            if (tags.some(t => t.name === tagName)) {
                alert('Deze tag bestaat al');
                return;
            }

            tags.push({ name: tagName, color: generateTagColor() });
            localStorage.setItem('tags', JSON.stringify(tags));
            input.value = '';
            renderAvailableTags();
        }

        function generateTagColor() {
            const colors = ['#6366f1', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function renderAvailableTags() {
            const list = document.getElementById('availableTagsList');
            list.innerHTML = tags.map(tag => `
                <div class="tag" style="background: ${tag.color}30; border: 2px solid ${tag.color}; color: ${tag.color};">
                    ${tag.name}
                    <button onclick="deleteTag('${tag.name}')" style="background: none; border: none; color: ${tag.color}; cursor: pointer;">√ó</button>
                </div>
            `).join('');
        }

        function deleteTag(tagName) {
            tags = tags.filter(t => t.name !== tagName);
            localStorage.setItem('tags', JSON.stringify(tags));
            renderAvailableTags();
        }

        function addTagToTask(taskId, tagName) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            if (!task.tags) task.tags = [];
            if (!task.tags.includes(tagName)) {
                task.tags.push(tagName);
                saveTasks();
            }
        }

        // Filter tasks by tag
        function applyTagFilter(tagName) {
            const filtered = tasks.filter(t => t.tags && t.tags.includes(tagName) && !t.completed);
            
            const taskList = document.getElementById('taskList');
            if (filtered.length === 0) {
                taskList.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üè∑Ô∏è</div><h3>Geen taken met tag ${tagName}</h3></div>`;
                return;
            }

            const priorityLabels = { high: 'Hoog', medium: 'Gemiddeld', low: 'Laag' };
            const statusLabels = { 
                todo: 'üìã Te doen', 
                'in-progress': '‚ö° In uitvoering', 
                blocked: 'üö´ Geblokkeerd', 
                review: 'üëÄ Review', 
                done: '‚úÖ Klaar' 
            };

            taskList.innerHTML = filtered.map(task => {
                const isOverdue = task.deadline && new Date(task.deadline) < new Date() && !task.completed;
                const taskStatus = task.status || 'todo';
                
                return `
                    <div class="task-card status-${taskStatus} ${task.completed ? 'completed' : ''}">
                        <div class="task-header">
                            <div class="task-checkbox ${task.completed ? 'checked' : ''}" 
                                 onclick="toggleTask('${task.id}')"></div>
                            <div class="task-content">
                                <div class="task-title">${task.title}</div>
                                ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                                <div class="task-meta">
                                    ${task.project ? `<span class="badge badge-project">üìÅ ${task.project}</span>` : ''}
                                    <span class="badge badge-status ${taskStatus}">${statusLabels[taskStatus]}</span>
                                    <span class="badge badge-priority ${task.priority}">
                                        ${task.priority === 'high' ? 'üî•' : task.priority === 'medium' ? '‚ö°' : '‚úì'} 
                                        ${priorityLabels[task.priority]}
                                    </span>
                                    ${task.deadline ? `
                                        <span class="badge badge-deadline ${isOverdue ? 'badge-priority' : ''}">
                                            üìÖ ${new Date(task.deadline).toLocaleDateString('nl-NL')}
                                            ${isOverdue ? ' (Verlopen!)' : ''}
                                        </span>
                                    ` : ''}
                                    ${task.assignedTo ? `<span class="badge badge-assigned">üë§ ${task.assignedTo}</span>` : ''}
                                </div>
                            </div>
                            <div class="task-actions">
                                <button class="log-btn" onclick="showTaskLog('${task.id}')" title="Activiteiten">üìã</button>
                                <button class="icon-btn" onclick="editTask('${task.id}')" title="Bewerken">‚úèÔ∏è</button>
                                <button class="icon-btn" onclick="deleteTask('${task.id}')" title="Verwijderen">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load from localStorage
        window.addEventListener('load', () => {
            loadTasks();
            const storedTemplates = localStorage.getItem('templates');
            if (storedTemplates) templates = JSON.parse(storedTemplates);
            const storedTags = localStorage.getItem('tags');
            if (storedTags) tags = JSON.parse(storedTags);
            
            renderTemplatesList();
            renderAvailableTags();
            updateProjectSelect();
            renderProjectTabs();
            updateStats();
            updateStatistics();
            renderTasks();
        });
    </script>
</body>
</html>
