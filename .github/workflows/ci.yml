name: CI - HTML5 Standalone Apps

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  validate-html:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate HTML files exist
        run: |
          echo "=== Checking HTML files ==="
          test -f "gym-tracker.html" && echo "✓ gym-tracker.html" || (echo "✗ Missing gym-tracker.html" && exit 1)
          test -f "Sport tracker/gym-tracker.html" && echo "✓ Sport tracker/gym-tracker.html" || (echo "✗ Missing Sport tracker/gym-tracker.html" && exit 1)
          test -f "personal-index/index.html" && echo "✓ personal-index/index.html" || (echo "✗ Missing personal-index/index.html" && exit 1)
          test -f "README.md" && echo "✓ README.md" || (echo "✗ Missing README.md" && exit 1)

      - name: Check HTML structure
        run: |
          echo "=== Validating HTML structure ==="
          for file in gym-tracker.html "Sport tracker/gym-tracker.html" personal-index/index.html personal-index/vakantieplanning.html personal-index/werknemerplanning.html; do
            if [ -f "$file" ]; then
              echo "Checking $file..."
              grep -q "<!DOCTYPE html>" "$file" && echo "  ✓ Valid DOCTYPE" || echo "  ⚠ Missing DOCTYPE"
              grep -q "<html" "$file" && echo "  ✓ HTML tag found" || echo "  ⚠ Missing HTML tag"
              grep -q "<body" "$file" && echo "  ✓ Body tag found" || echo "  ⚠ Missing body tag"
              grep -q "</html>" "$file" && echo "  ✓ Closing HTML tag found" || echo "  ⚠ Missing closing HTML tag"
            fi
          done

      - name: Repository info
        run: |
          echo "=== Repository Information ==="
          echo "Project: Gym-Tracker"
          echo "Type: HTML5 Standalone Applications"
          echo "No Node.js/npm dependencies required"
          ls -la

  validate-pwa-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate PWA files
        run: |
          echo "=== Checking PWA files ==="
          test -f "manifest.json" && echo "✓ manifest.json" || (echo "✗ Missing manifest.json" && exit 1)
          test -f "service-worker.js" && echo "✓ service-worker.js" || (echo "✗ Missing service-worker.js" && exit 1)
          test -f "index.html" && echo "✓ index.html" || (echo "✗ Missing index.html" && exit 1)

      - name: Validate service worker references
        run: |
          echo "=== Checking service worker wiring ==="
          grep -q "service-worker.js" "index.html" && echo "✓ index.html references service-worker.js" || echo "⚠ No service-worker.js reference found in index.html"
          grep -q "manifest.json" "index.html" && echo "✓ index.html references manifest.json" || echo "⚠ No manifest.json reference found in index.html"

  validate-versioning:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate app version markers
        run: |
          echo "=== Checking app version markers ==="
          grep -q "APP_VERSION" "gym-tracker.html" && echo "✓ gym-tracker.html has APP_VERSION" || (echo "✗ APP_VERSION missing in gym-tracker.html" && exit 1)
          grep -q "APP_VERSION" "Sport tracker/gym-tracker.html" && echo "✓ Sport tracker/gym-tracker.html has APP_VERSION" || (echo "✗ APP_VERSION missing in Sport tracker/gym-tracker.html" && exit 1)

      - name: Validate release tag format in main file
        run: |
          echo "=== Checking release tag format ==="
          grep -E 'const APP_VERSION = "[0-9]{4}-[0-9]{2}-[0-9]{2}-[0-9]+";' "gym-tracker.html" && echo "✓ APP_VERSION format is valid" || (echo "✗ APP_VERSION format invalid in gym-tracker.html" && exit 1)